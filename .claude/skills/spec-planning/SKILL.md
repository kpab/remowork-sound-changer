---
name: spec-planning
description: |
  機能開発・バグ修正の計画・仕様策定時に使用するスキル。
  「実装したい」「機能を追加」「バグを直す」「〇〇を作る」で自動発動。
  要件が曖昧な場合はしつこく質問し、仮定で進めない。
allowed-tools: Read, Grep, Glob, Write
version: 1.0.0
updated: 2024-12-27
---

# 計画・仕様策定スキル (Chrome拡張機能向け)

## 概要

Chrome拡張機能の機能開発・バグ修正における**要件定義から仕様確定まで**を担当。
**仮定を入れて進めることを禁止**し、不明点は必ずユーザーに確認する。

## 使用タイミング

- 新機能の実装依頼時
- 既存機能の改修依頼時
- バグ修正の依頼時
- 「〇〇を作りたい」「〇〇を実装して」という要望時

---

## 使用宣言

**このスキルを使用する場合、作業開始時に以下を宣言すること:**

```
このタスクでは spec-planning スキルを使用します。
参照: .claude/skills/spec-planning/SKILL.md
```

---

## 絶対ルール（厳守）

### 仮定禁止の原則

```
❌ 禁止: 「〇〇だと仮定して進めます」
❌ 禁止: 「おそらく〇〇だと思うので」
❌ 禁止: 「一般的には〇〇なので」
❌ 禁止: 曖昧なまま実装を開始する

✅ 必須: 「〇〇について確認させてください」
✅ 必須: 「〇〇はどちらを想定していますか？」
✅ 必須: 全ての必須項目が埋まるまで質問を続ける
```

### フロー（必須）

```
Phase 1: 要件ヒアリング（必須項目が全て埋まるまで）
    ↓
Phase 2: 仕様の明文化（specドキュメント作成）
    ↓
Phase 3: ユーザー承認（仕様の最終確認）
    ↓
Phase 4: 実装開始
```

---

## Phase 1: 要件ヒアリング（必須・省略不可）

### 1.1 必須ヒアリング項目

以下の**全項目**に対する回答が得られるまで Phase 2 に進まない：

| # | 項目 | 質問例 | 必須 |
|---|------|--------|------|
| 1 | **目的・背景** | なぜこの機能が必要ですか？どんな課題を解決しますか？ | ○ |
| 2 | **ユーザーストーリー** | 誰が、どんな状況で、何をしたいですか？ | ○ |
| 3 | **対象コンポーネント** | どのファイルに実装？Popup? Content Script? Service Worker? | ○ |
| 4 | **正常系フロー** | 期待する操作の流れを教えてください | ○ |
| 5 | **異常系・エッジケース** | エラー時はどう動作すべきですか？ | ○ |
| 6 | **データ保存** | chrome.storage を使う？どんなデータ構造？ | ○ |
| 7 | **既存機能への影響** | 他の機能に影響がありそうな箇所はありますか？ | ○ |
| 8 | **パーミッション** | 追加のパーミッションが必要ですか？ | ○ |
| 9 | **受け入れ条件** | 何ができたら完了とみなしますか？ | ○ |

### 1.2 Chrome拡張特有の確認事項

| 項目 | 質問 |
|------|------|
| 対象サイト | host_permissions に追加が必要？ |
| コンテキスト | どのコンテキストで動作？（Content/Background/Popup） |
| 通信 | コンテキスト間でメッセージングが必要？ |
| MV3準拠 | Manifest V3 の制約を満たしている？ |

### 1.3 ヒアリングテンプレート

初回の質問時に以下を使用：

```markdown
## 要件ヒアリング

実装を進める前に、以下を確認させてください：

### 基本情報
1. **目的・背景**: この機能が必要な理由は？
2. **ユーザーストーリー**: 誰が何をしたい？

### 実装範囲
3. **対象コンポーネント**: どこに実装？（Popup / Content Script / Service Worker）
4. **正常系フロー**: 期待する操作の流れは？
5. **異常系**: エラー時の動作は？

### 技術要件
6. **データ保存**: chrome.storage を使う？データ構造は？
7. **既存機能への影響**: 他の機能への影響は？
8. **パーミッション**: 追加のパーミッションは必要？

### 完了条件
9. **受け入れ条件**: 何ができたら完了？
```

### 1.4 ヒアリング完了チェックリスト

| # | 項目 | 確認 |
|---|------|------|
| 1 | 全必須項目に回答がある | [ ] |
| 2 | 曖昧な回答がない | [ ] |
| 3 | 「仮定」を入れていない | [ ] |
| 4 | ユーザーが内容を確認した | [ ] |

---

## Phase 2: 仕様の明文化

### 2.1 specドキュメント作成

ヒアリング完了後、以下の形式でspecドキュメントを作成：

**保存先:** `.claude/spec/{feature-name}.md`

### 2.2 specテンプレート

```markdown
# {機能名} 実装仕様書

## 基本情報

| 項目 | 内容 |
|------|------|
| 作成日 | YYYY-MM-DD |
| ステータス | 計画中 / 実装中 / 完了 |

---

## 1. 概要

### 1.1 目的・背景
{なぜこの機能が必要か}

### 1.2 ユーザーストーリー
{誰が何をしたいか}

---

## 2. 機能要件

### 2.1 対象コンポーネント

| コンポーネント | ファイル | 新規/改修 |
|---------------|---------|----------|
| Popup | popup.js | 改修 |
| Content Script | content.js | 新規 |
| Service Worker | background.js | 改修 |

### 2.2 正常系フロー

```
1. ユーザーが〇〇する
2. システムが〇〇する
3. 結果として〇〇が表示される
```

### 2.3 異常系・エッジケース

| ケース | 動作 |
|--------|------|
| 〇〇エラー時 | メッセージ表示 |
| 〇〇がない場合 | デフォルト値使用 |

---

## 3. 技術要件

### 3.1 データ構造

```javascript
// chrome.storage.local に保存するデータ
{
  "settingKey": {
    "option1": "value1",
    "option2": true
  }
}
```

### 3.2 メッセージング

| 送信元 | 送信先 | メッセージ型 |
|--------|--------|------------|
| Popup | Service Worker | { type: 'GET_DATA' } |
| Content | Service Worker | { type: 'SAVE_DATA', data: {...} } |

### 3.3 パーミッション

| パーミッション | 用途 |
|---------------|------|
| storage | 設定保存 |
| tabs | タブ情報取得 |

### 3.4 Manifest 変更

```json
{
  "permissions": ["storage"],
  "host_permissions": ["https://example.com/*"]
}
```

---

## 4. 受け入れ条件

- [ ] 〇〇ができること
- [ ] 〇〇が表示されること
- [ ] エラー時に〇〇が表示されること

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| YYYY-MM-DD | 初版作成 |
```

---

## Phase 3: ユーザー承認

### 3.1 確認依頼

specドキュメント作成後、必ず以下を実施：

```markdown
## 仕様確認のお願い

上記の仕様書を作成しました。以下を確認してください：

1. **機能要件**: 期待する動作と合っていますか？
2. **異常系**: エラー処理は十分ですか？
3. **受け入れ条件**: 完了条件は適切ですか？

問題なければ「OK」とお伝えください。
修正が必要な場合は具体的にお知らせください。
```

### 3.2 承認後の宣言

ユーザーが承認したら以下を宣言：

```
仕様が確定しました。実装を開始します。
```

---

## チェックリスト（全体）

| Phase | チェック項目 | 確認 |
|-------|-------------|------|
| 1 | 全必須項目をヒアリングした | [ ] |
| 1 | 仮定を入れていない | [ ] |
| 1 | 曖昧な回答を深掘りした | [ ] |
| 2 | specドキュメントを作成した | [ ] |
| 3 | ユーザーの承認を得た | [ ] |

---

## 関連スキル

| スキル | 用途 |
|--------|------|
| [chrome-extension-dev](../chrome-extension-dev/SKILL.md) | Chrome拡張開発ガイド |
| [research](../research/SKILL.md) | 技術調査 |

---

## Version History

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| v1.0.0 | 2024-12-27 | 初版作成（Chrome拡張向け） |
